version: '2'
services:
  api:
    image: toddmohney/feature-creature:v6
    command: /usr/share/feature-creature/feature-creature-web
    container_name: feature-creature
    depends_on:
      - data
      - database
    env_file:
      - ./env/development.aws.env
      - ./env/development.env
    links:
      - "database:database.local"
      - "search:search.local"
    ports:
      - "8081:8081"
    volumes_from:
      - data:rw

  web:
    image: toddmohney/feature-creature-client:v1
    command: rackup --host 0.0.0.0 --port 4567
    container_name: feature-creature-client
    depends_on:
      - api
    env_file:
      - ./env/development.aws.env
      - ./env/development.env
    links:
      - "api:api.local"
    ports:
      - "4567:4567"

  search_service:
    image: toddmohney/feature-creature:v6
    container_name: search-service
    command: /usr/share/feature-creature/search-service
    depends_on:
      - api
      - data
      - search
    env_file:
      - ./env/development.aws.env
      - ./env/development.env
    links:
      - "search:search.local"
    volumes_from:
      - data:rw

  repo-refresher:
    image: toddmohney/feature-creature:v6
    container_name: repo-refresher
    command: /usr/share/feature-creature/repo-refresher
    depends_on:
      - api
      - data
      - search
    env_file:
      - ./env/development.aws.env
      - ./env/development.env
    links:
    links:
      - "database:database.local"
      - "search:search.local"
    volumes_from:
      - data:rw

  data:
    image: toddmohney/feature-creature-client:v1 # reuse an image we have cached already
    container_name: shared-data
    command: /bin/echo hi
    volumes:
      - "/usr/share/feature-creature/data"

  database:
    image: postgres:9.4.6
    environment:
      POSTGRES_DB: feature_creature
      POSTGRES_USER: feature_creature
    volumes:
      - "/var/lib/postgresql/data"

  search:
    image: elasticsearch:2.2.0
    volumes:
      - "/usr/share/elasticsearch/data"
